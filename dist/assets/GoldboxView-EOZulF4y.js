import{P as ke,T as x}from"./trade-BtGVMP26.js";import{_ as ce,o as I,m as O,e as l,r as n,q as E,j as Ce,i as A,k as We,g as a,w as s,c as K,d as de,u as Ie,a as r,t as u,b as p}from"./index-GbV0-74n.js";const he={},je={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ue(pe,h){return I(),O("svg",je,h[0]||(h[0]=[l("path",{d:"M11.4298 1.5H6.56978C3.74978 1.5 3.53228 4.035 5.05478 5.415L12.9448 12.585C14.4673 13.965 14.2498 16.5 11.4298 16.5H6.56978C3.74978 16.5 3.53228 13.965 5.05478 12.585L12.9448 5.415C14.4673 4.035 14.2498 1.5 11.4298 1.5Z",stroke:"#3C3C3C","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),l("path",{d:"M6 12H12",stroke:"#3C3C3C"},null,-1),l("path",{d:"M13.825 14.9223C12.8356 17.1723 5.57501 16.7973 4.82509 15.6722C3.62088 13.8655 5.1551 11.9479 6.00015 12H12.0001C12.0393 11.9562 14.5422 13.2914 13.825 14.9223Z",fill:"#3C3C3C"},null,-1)]))}const ve=ce(he,[["render",Ue]]),Se={class:"d-md-none live-price-box"},Be={class:"live-price"},Me={class:"d-flex justify-center"},Fe={class:"price-live-card"},Ge={class:"d-flex justify-space-between my-2"},Le={class:"price-change"},$e={class:"d-flex justify-space-between my-2"},qe={class:"live-price"},De={class:"d-flex justify-center"},Ee={class:"price-live-card"},Ne={class:"d-flex justify-space-between my-2"},ze={class:"price-change"},He={class:"d-flex justify-space-between my-2"},Re={key:1,class:"live-price"},Ze={class:"trade-history"},Ae={class:"d-flex justify-space-between"},Ke={class:""},Oe={class:""},Je={class:"buyModal-content py-10"},Qe={class:"wallet-badge my-2"},Xe={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},Ye={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},el={class:"d-flex justify-space-evenly align-center w-100 my-2"},ll={class:"d-flex"},tl={class:"d-flex justify-space-around my-2"},al={class:"buyModal-content py-10"},sl={class:"wallet-badge my-2"},ol={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},nl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},ul={class:"d-flex justify-space-evenly align-center w-100 my-2"},il={class:"d-flex"},rl={class:"d-flex justify-space-around my-2"},dl={__name:"GoldboxView",setup(pe){const h=Ie(),G=n(null),j=n(!1),U=n(!1),N=n(!1),f=n(""),J=n(""),i=n(!1),z=n(!1),w=n(!1),P=n(!1),L=n(null),d=n({sellPrice:"",buyPrice:"",change:""}),V=n(30),T=n(!1),Q=n(),X=n(),Y=n([{title:"تاریخ",key:"date"},{title:"زمان",key:"time"},{title:"وزن طلا(گرم)",key:"goldWeight"},{title:"قیمت نهایی",key:"totalPrice"},{title:"قیمت طلا در لحظه",key:"goldPrice"},{title:"وضعیت",key:"status"}]),me=n([{text:"موفق",value:"completed"},{text:"ناموفق",value:"failed"},{text:"همه",value:""}]);let $=n(null);const H=n({invoiceId:"",paymentUrl:""}),v=n({goldprice:"",goldWeight:""}),m=n({goldPrice:"",goldWeight:""}),y=n({invoiceId:"",amount:"",isFromWallet:"",balance:0}),_=n({invoiceId:"",amount:"",isFromWallet:"",balance:0,goldWeight:0}),k=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),S=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),B=n({type:"",status:""}),R=n({}),fe=[t=>!!t||"مقدار نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,2})?$/.test(t)||"مقدار میتواند تا 2 رقم اعشار باشد "],b=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),ee=async()=>{try{N.value=!0;const t=await ke.GoldPrice();return d.value.buyPrice=t.buyPrice,d.value.sellPrice=t.sellPrice,d.value.change=t.change,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},1e4)}finally{N.value=!1}};E(()=>[v.value.goldWeight,v.value.goldprice],([t,e],[g,q])=>{const C=t===""?0:parseFloat(t),c=e===""?0:parseFloat(e);t!==g?v.value.goldprice=C*d.value.buyPrice:e!==q&&(c<1e5?v.value.goldWeight=0:v.value.goldWeight=c/d.value.buyPrice)});const ge=()=>{m.value.goldPrice=m.value.goldWeight*d.value.sellPrice},ye=async()=>{try{j.value=!0,k.value.type="buy",k.value.totalPrice=v.value.goldprice,k.value.goldWeight=v.value.goldWeight,k.value.goldPrice=d.value.buyPrice,console.log(k);const t=await x.createInvoice(k.value);return y.value.invoiceId=t.transactionId,y.value.balance=t.wallet.balance,w.value=!0,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},5e3)}finally{j.value=!1}},le=async t=>{try{j.value=!0,t=="wallet"?y.value.isFromWallet=!0:y.value.isFromWallet=!1,y.value.amount=v.value.goldprice;const e=await x.complateTransaction(y.value);return e.isFromWallet==!0?(w.value=!1,A.push("./")):(H.value.paymentUrl=e.paymentUrl,H.value.invoiceId=e.invoiceId,window.location.href=H.value.paymentUrl),e}catch(e){f.value=e.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},5e3)}finally{j.value=!1,Transaction()}},_e=async()=>{try{U.value=!0,S.value.type="sell",S.value.totalPrice=m.value.goldPrice,S.value.goldWeight=m.value.goldWeight,S.value.goldPrice=d.value.sellPrice;const t=await x.createSellInvoice(S.value);return _.value.invoiceId=t.transactionId,_.value.balance=t.wallet.balance,_.value.goldWeight=t.wallet.goldWeight,P.value=!0,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},5e3)}finally{U.value=!1}},be=async()=>{try{U.value=!0,_.value.amount=m.value.goldPrice,_.value.fee=1;const t=await x.complateSellTransaction(_.value);return P.value=!1,J.value="طلای شما با موفقیت به فروش رسید",z.value=!0,setTimeout(()=>{z.value=!1},5e3),t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},5e3)}finally{U.value=!1,Transaction()}},xe=t=>{B.value.status=t.value,te(),ae()},te=async()=>{try{B.value.type="sell",T.value=!0;const t=await x.Transactions(B.value);return Q.value=t,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},1e4)}finally{T.value=!1}},ae=async()=>{try{B.value.type="buy",T.value=!0;const t=await x.Transactions(B.value);return X.value=t,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},1e4)}finally{T.value=!1}},we=async t=>{try{const e=await x.VerifyTransaction(t);return console.log(e),R.value=e,e}catch(e){f.value=e.response.data.msg||"خطایی رخ داده است!",i.value=!0,setTimeout(()=>{i.value=!1},1e4)}};Ce(()=>{ee(),ae(),te(),setInterval(()=>{ee()},3e4);const t=n({authority:h.query.Authority,status:h.query.Status});t.value.authority&&t.value.status&&(we(t.value),t.value.status==="OK"?A.push({name:"success",query:R.value}):A.push({name:"failed",query:R.value}))}),E(d.value,()=>{console.log("price changed")}),E(w,t=>{t?(V.value=30,se()):M()}),E(P,t=>{t?(V.value=30,se()):M()});const se=()=>{M(),$=setInterval(()=>{V.value>0?V.value--:(M(),w.value=!1,P.value=!1)},1e3)},M=()=>{$&&(clearInterval($),$=null)};return We(()=>{M()}),(t,e)=>{const g=r("v-tab"),q=r("v-tabs"),C=r("v-text-field"),c=r("v-col"),F=r("v-btn"),D=r("v-row"),W=r("v-tabs-window-item"),Pe=r("v-progress-circular"),oe=r("v-tabs-window"),Ve=r("v-card-text"),Z=r("v-card"),Te=r("v-combobox"),ne=r("v-chip"),ue=r("v-data-table"),ie=r("v-dialog"),re=r("v-alert");return I(),O("div",null,[e[45]||(e[45]=l("div",{class:"d-flex flex-column align-center"},[l("h3",{class:"title"},"خرید و فروش طلا"),l("p",{class:"subtitle"},"با خیال راحت در خانه طلا خرید و فروش کنید")],-1)),a(Z,{class:"trade-card mt-3"},{default:s(()=>[l("div",Se,[e[13]||(e[13]=l("div",null,[l("span",{class:"live-tag"},"live"),l("span",{class:"weight-tag"},"1 گرم")],-1)),l("div",null,[e[12]||(e[12]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("span",Be,u(b(d.value.buyPrice))+" ریال",1)])]),a(q,{modelValue:G.value,"onUpdate:modelValue":e[0]||(e[0]=o=>G.value=o),"bg-color":"white",class:"tab-header"},{default:s(()=>[a(g,{value:"one"},{default:s(()=>e[14]||(e[14]=[p("خرید")])),_:1}),a(g,{value:"two"},{default:s(()=>e[15]||(e[15]=[p("فروش")])),_:1}),a(g,{value:"three"},{default:s(()=>e[16]||(e[16]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(Ve,null,{default:s(()=>[a(oe,{modelValue:G.value,"onUpdate:modelValue":e[4]||(e[4]=o=>G.value=o)},{default:s(()=>[a(W,{value:"one"},{default:s(()=>[a(D,null,{default:s(()=>[a(c,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(D,null,{default:s(()=>[a(c,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[17]||(e[17]=l("span",null,"وزن طلا (گرم)",-1)),a(C,{modelValue:v.value.goldWeight,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value.goldWeight=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[18]||(e[18]=l("span",null,"مبلغ (ریال)",-1)),a(C,{modelValue:v.value.goldprice,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value.goldprice=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",class:"my-2"},{default:s(()=>[l("div",Me,[a(F,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:j.value,onClick:ye},{default:s(()=>e[19]||(e[19]=[p("خرید")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(c,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[l("div",Fe,[l("div",Ge,[l("span",Le,u(d.value.change),1),e[20]||(e[20]=l("span",{class:"live-tag"},"live",-1))]),e[22]||(e[22]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("div",$e,[l("span",qe,u(b(d.value.buyPrice))+" ریال",1),e[21]||(e[21]=l("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(W,{value:"two"},{default:s(()=>[a(D,null,{default:s(()=>[a(c,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(D,null,{default:s(()=>[a(c,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[23]||(e[23]=l("span",null,"وزن طلا (گرم)",-1)),a(C,{variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",modelValue:m.value.goldWeight,"onUpdate:modelValue":e[3]||(e[3]=o=>m.value.goldWeight=o),onInput:ge,rules:fe},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[24]||(e[24]=l("span",null,"مبلغ (ریال)",-1)),a(C,{variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",disabled:""},{default:s(()=>[p(u(m.value.goldPrice),1)]),_:1})]),_:1}),a(c,{cols:"12",class:"my-2"},{default:s(()=>[l("div",De,[a(F,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:U.value,onClick:_e},{default:s(()=>e[25]||(e[25]=[p("فروش")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(c,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[l("div",Ee,[l("div",Ne,[l("span",ze,u(d.value.change),1),e[26]||(e[26]=l("span",{class:"live-tag"},"live",-1))]),e[28]||(e[28]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("div",He,[N.value?(I(),K(Pe,{key:0,size:10,color:"#fff",indeterminate:""})):(I(),O("span",Re,u(b(d.value.buyPrice))+" ریال",1)),e[27]||(e[27]=l("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(W,{value:"three"},{default:s(()=>e[29]||(e[29]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e[46]||(e[46]=l("h3",{class:"title"},"تاریخچه تراکنش ها",-1)),l("div",Ze,[l("div",Ae,[a(q,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=o=>L.value=o),"bg-color":"white"},{default:s(()=>[a(g,{value:"one"},{default:s(()=>e[30]||(e[30]=[p("خرید")])),_:1}),a(g,{value:"two"},{default:s(()=>e[31]||(e[31]=[p("فروش")])),_:1}),a(g,{value:"three"},{default:s(()=>e[32]||(e[32]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(Te,{label:"وضعیت پرداخت",items:me.value,"item-title":"text","item-value":"value",density:"comfortable",variant:"solo",class:"transaction-filter","onUpdate:modelValue":xe},null,8,["items"])]),a(oe,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=o=>L.value=o)},{default:s(()=>[a(W,{value:"one",class:"transaction-box"},{default:s(()=>[e[33]||(e[33]=l("div",{class:"d-flex justify-end"},null,-1)),a(ue,{headers:Y.value,items:X.value,loading:T.value,class:"transaction-table"},{"item.status":s(({item:o})=>[l("div",Ke,[a(ne,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[l("p",null,u(b(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[l("p",null,u(b(o.totalPrice)),1)]),_:1},8,["headers","items","loading"])]),_:1}),a(W,{value:"two",class:"transaction-box"},{default:s(()=>[a(ue,{headers:Y.value,items:Q.value,loading:T.value,class:"transaction-table"},{"item.status":s(({item:o})=>[l("div",Oe,[a(ne,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[l("p",null,u(b(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[l("p",null,u(b(o.totalPrice)),1)]),_:1},8,["headers","items","loading"])]),_:1}),a(W,{value:"three"},{default:s(()=>e[34]||(e[34]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),a(ie,{"max-width":"500",modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=o=>w.value=o)},{default:s(()=>[a(Z,null,{default:s(()=>[l("div",Je,[e[39]||(e[39]=l("h3",null,"فاکتور خرید",-1)),l("div",Qe,[e[35]||(e[35]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,u(y.value.balance)+" ریال",1)]),l("div",Xe,[e[36]||(e[36]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,u(v.value.goldWeight)+" گرم",1)]),l("div",Ye,[e[37]||(e[37]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,u(v.value.goldprice)+" ریال",1)]),l("div",el,[e[38]||(e[38]=l("span",{class:"fee"},"کارمزد 0 درصد",-1)),l("div",ll,[l("span",null,u(V.value),1),a(ve)])])]),l("div",tl,[a(F,{text:"پرداخت مستقیم",class:"pay-btn",color:"#9D7E3B",onClick:e[7]||(e[7]=o=>le("direct"))}),a(F,{text:"پرداخت از کیف پول",class:"pay-btn",color:"#9D7E3B",variant:"outlined",onClick:e[8]||(e[8]=o=>le("wallet"))})])]),_:1})]),_:1},8,["modelValue"]),a(ie,{"max-width":"500",modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=o=>P.value=o)},{default:s(()=>[a(Z,null,{default:s(()=>[l("div",al,[e[44]||(e[44]=l("h3",null,"فاکتور فروش",-1)),l("div",sl,[e[40]||(e[40]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,u(_.value.goldWeight)+" گرم",1)]),l("div",ol,[e[41]||(e[41]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,u(m.value.goldWeight)+" گرم",1)]),l("div",nl,[e[42]||(e[42]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,u(m.value.goldPrice)+" ریال",1)]),l("div",ul,[e[43]||(e[43]=l("span",{class:"fee"},"کارمزد 1 درصد",-1)),l("div",il,[l("span",null,u(V.value),1),a(ve)])])]),l("div",rl,[a(F,{text:"تایید فروش",class:"pay-btn",color:"#9D7E3B",onClick:e[10]||(e[10]=o=>be())})])]),_:1})]),_:1},8,["modelValue"]),i.value?(I(),K(re,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(u(f.value),1)]),_:1})):de("",!0),z.value?(I(),K(re,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(u(J.value),1)]),_:1})):de("",!0)])}}},pl=ce(dl,[["__scopeId","data-v-56e87394"]]);export{pl as default};
