import{P as Ie,T as b}from"./trade-B-Hknr98.js";import{_ as ce,o as T,m as A,e as l,r as n,j as je,i as R,q as de,k as Ue,g as a,w as s,c as Z,d as re,u as Be,a as v,t as d,b as p}from"./index-BHSjVa9P.js";const Se={},Ge={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Me(pe,k){return T(),A("svg",Ge,k[0]||(k[0]=[l("path",{d:"M11.4298 1.5H6.56978C3.74978 1.5 3.53228 4.035 5.05478 5.415L12.9448 12.585C14.4673 13.965 14.2498 16.5 11.4298 16.5H6.56978C3.74978 16.5 3.53228 13.965 5.05478 12.585L12.9448 5.415C14.4673 4.035 14.2498 1.5 11.4298 1.5Z",stroke:"#3C3C3C","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),l("path",{d:"M6 12H12",stroke:"#3C3C3C"},null,-1),l("path",{d:"M13.825 14.9223C12.8356 17.1723 5.57501 16.7973 4.82509 15.6722C3.62088 13.8655 5.1551 11.9479 6.00015 12H12.0001C12.0393 11.9562 14.5422 13.2914 13.825 14.9223Z",fill:"#3C3C3C"},null,-1)]))}const ve=ce(Se,[["render",Me]]),Fe={class:"d-md-none live-price-box"},$e={class:"live-price"},Le={class:"d-flex justify-center"},De={class:"price-live-card"},Ee={class:"d-flex justify-space-between my-2"},Ne={class:"price-change"},ze={class:"d-flex justify-space-between my-2"},He={class:"live-price"},qe={class:"d-flex justify-center"},Re={class:"price-live-card"},Ze={class:"d-flex justify-space-between my-2"},Ae={class:"price-change"},Ke={class:"d-flex justify-space-between my-2"},Oe={key:1,class:"live-price"},Je={class:"trade-history"},Qe={class:"d-flex justify-space-between"},Xe={class:""},Ye={class:""},el={class:"buyModal-content py-10"},ll={class:"wallet-badge my-2"},tl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},al={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},sl={class:"d-flex justify-space-evenly align-center w-100 my-2"},ol={class:"d-flex"},nl={class:"d-flex justify-space-around my-2"},ul={class:"buyModal-content py-10"},il={class:"wallet-badge my-2"},dl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},rl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},vl={class:"d-flex justify-space-evenly align-center w-100 my-2"},cl={class:"d-flex"},pl={class:"d-flex justify-space-around my-2"},gl={__name:"GoldboxView",setup(pe){const k=Be(),G=n(null),I=n(!1),j=n(!1),D=n(!1),m=n(""),K=n(""),r=n(!1),E=n(!1),x=n(!1),w=n(!1),M=n(null),c=n({sellPrice:"",buyPrice:"",change:""}),P=n(30),V=n(!1),O=n(),J=n(),Q=n([{title:"تاریخ",key:"date"},{title:"زمان",key:"time"},{title:"وزن طلا(گرم)",key:"goldWeight"},{title:"قیمت نهایی",key:"totalPrice"},{title:"قیمت طلا در لحظه",key:"goldPrice"},{title:"وضعیت",key:"status"}]),ge=n([{text:"موفق",value:"success"},{text:"ناموفق",value:"failed"},{text:"نامشخص",value:"pending"},{text:"همه",value:""}]);let F=n(null);const N=n({invoiceId:"",paymentUrl:""}),u=n({goldprice:"",goldWeight:""}),i=n({goldPrice:"",goldWeight:""}),f=n({invoiceId:"",amount:"",isFromWallet:"",balance:0}),y=n({invoiceId:"",amount:"",isFromWallet:"",balance:0,goldWeight:0}),W=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),U=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),z=n({status:""}),H=n({}),me=[t=>!!t||"مقدار نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,2})?$/.test(t)||"مقدار میتواند تا 2 رقم اعشار باشد "],_=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),X=async()=>{try{D.value=!0;const t=await Ie.GoldPrice();return c.value.buyPrice=t.buyPrice,c.value.sellPrice=t.sellPrice,c.value.change=t.change,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{D.value=!1}},fe=()=>{u.value.goldprice=u.value.goldprice.replace(/[^0-9]/g,""),u.value.goldWeight=(u.value.goldprice/c.value.buyPrice).toFixed(2)},ye=()=>{u.value.goldWeight=u.value.goldWeight.replace(/[^0-9.]/g,"");const t=u.value.goldWeight.split(".");t.length>1&&(u.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(u.value.goldWeight=t[0]+"."+t[1].slice(0,2)),u.value.goldprice=parseInt(u.value.goldWeight*c.value.buyPrice)},_e=()=>{i.value.goldPrice=i.value.goldPrice.replace(/[^0-9]/g,""),i.value.goldWeight=(i.value.goldPrice/c.value.sellPrice).toFixed(2)},be=()=>{i.value.goldWeight=i.value.goldWeight.replace(/[^0-9.]/g,"");const t=i.value.goldWeight.split(".");t.length>1&&(i.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(i.value.goldWeight=t[0]+"."+t[1].slice(0,2)),i.value.goldPrice=parseInt(i.value.goldWeight*c.value.sellPrice)},xe=[t=>!!t||"مقدار ورودی نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,2})?$/.test(t)||"فقط عدد مجاز است و حداکثر ۲ رقم اعشار"],we=async()=>{try{I.value=!0,W.value.type="buy",W.value.totalPrice=u.value.goldprice,W.value.goldWeight=u.value.goldWeight,W.value.goldPrice=c.value.buyPrice,console.log(W);const t=await b.createInvoice(W.value);return f.value.invoiceId=t.transactionId,f.value.balance=t.wallet.balance,x.value=!0,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{I.value=!1}},Y=async t=>{try{I.value=!0,t=="wallet"?f.value.isFromWallet=!0:f.value.isFromWallet=!1,f.value.amount=u.value.goldprice;const e=await b.complateTransaction(f.value);return e.isFromWallet==!0?(x.value=!1,R.push("./")):(N.value.paymentUrl=e.paymentUrl,N.value.invoiceId=e.invoiceId,window.location.href=N.value.paymentUrl),e}catch(e){m.value=e.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{I.value=!1,Transaction()}},Pe=async()=>{try{j.value=!0,U.value.type="sell",U.value.totalPrice=i.value.goldPrice,U.value.goldWeight=i.value.goldWeight,U.value.goldPrice=c.value.sellPrice;const t=await b.createSellInvoice(U.value);return y.value.invoiceId=t.transactionId,y.value.balance=t.wallet.balance,y.value.goldWeight=t.wallet.goldWeight,w.value=!0,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{j.value=!1}},Ve=async()=>{try{j.value=!0,y.value.amount=i.value.goldPrice,y.value.fee=1;const t=await b.complateSellTransaction(y.value);return w.value=!1,K.value="طلای شما با موفقیت به فروش رسید",E.value=!0,setTimeout(()=>{E.value=!1},5e3),t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{j.value=!1,Transaction()}},We=t=>{z.value.status=t.value,ee(),le()},ee=async()=>{try{V.value=!0;const t=await b.GoldBoxSellTransactions(z.value);return O.value=t,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{V.value=!1}},le=async()=>{try{V.value=!0;const t=await b.GoldBoxBuyTransactions(z.value);return J.value=t,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{V.value=!1}},he=async t=>{try{const e=await b.VerifyTransaction(t);return console.log(e),H.value=e,e}catch(e){m.value=e.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}};je(()=>{X(),le(),ee(),setInterval(()=>{X()},3e4);const t=n({authority:k.query.Authority,status:k.query.Status});t.value.authority&&t.value.status&&(he(t.value),t.value.status==="OK"?R.push({name:"success",state:H.value}):R.push({name:"failed",state:H.value}))}),de(x,t=>{t?(P.value=30,te()):B()}),de(w,t=>{t?(P.value=30,te()):B()});const te=()=>{B(),F=setInterval(()=>{P.value>0?P.value--:(B(),x.value=!1,w.value=!1)},1e3)},B=()=>{F&&(clearInterval(F),F=null)};return Ue(()=>{B()}),(t,e)=>{const h=v("v-tab"),ae=v("v-tabs"),$=v("v-text-field"),g=v("v-col"),S=v("v-btn"),L=v("v-row"),C=v("v-tabs-window-item"),Ce=v("v-progress-circular"),se=v("v-tabs-window"),Te=v("v-card-text"),q=v("v-card"),ke=v("v-combobox"),oe=v("v-chip"),ne=v("v-data-table"),ue=v("v-dialog"),ie=v("v-alert");return T(),A("div",null,[e[46]||(e[46]=l("div",{class:"d-flex flex-column align-center"},[l("h3",{class:"title"},"خرید و فروش طلا"),l("p",{class:"subtitle"},"با خیال راحت در خانه طلا خرید و فروش کنید")],-1)),a(q,{class:"trade-card mt-3"},{default:s(()=>[l("div",Fe,[e[14]||(e[14]=l("div",null,[l("span",{class:"live-tag"},"live"),l("span",{class:"weight-tag"},"1 گرم")],-1)),l("div",null,[e[13]||(e[13]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("span",$e,d(_(c.value.buyPrice))+" ریال",1)])]),a(ae,{modelValue:G.value,"onUpdate:modelValue":e[0]||(e[0]=o=>G.value=o),"bg-color":"white",class:"tab-header"},{default:s(()=>[a(h,{value:"one"},{default:s(()=>e[15]||(e[15]=[p("خرید")])),_:1}),a(h,{value:"two"},{default:s(()=>e[16]||(e[16]=[p("فروش")])),_:1}),a(h,{value:"three"},{default:s(()=>e[17]||(e[17]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(Te,null,{default:s(()=>[a(se,{modelValue:G.value,"onUpdate:modelValue":e[5]||(e[5]=o=>G.value=o)},{default:s(()=>[a(C,{value:"one"},{default:s(()=>[a(L,null,{default:s(()=>[a(g,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(L,null,{default:s(()=>[a(g,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[18]||(e[18]=l("span",null,"وزن طلا (گرم)",-1)),a($,{modelValue:u.value.goldWeight,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.goldWeight=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:ye,rules:xe},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[19]||(e[19]=l("span",null,"مبلغ (ریال)",-1)),a($,{modelValue:u.value.goldprice,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value.goldprice=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:fe},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",class:"my-2"},{default:s(()=>[l("div",Le,[a(S,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:I.value,onClick:we},{default:s(()=>e[20]||(e[20]=[p("خرید")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(g,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[l("div",De,[l("div",Ee,[l("span",Ne,d(c.value.change)+" %",1),e[21]||(e[21]=l("span",{class:"live-tag"},"live",-1))]),e[23]||(e[23]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("div",ze,[l("span",He,d(_(c.value.buyPrice))+" ریال",1),e[22]||(e[22]=l("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(C,{value:"two"},{default:s(()=>[a(L,null,{default:s(()=>[a(g,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(L,null,{default:s(()=>[a(g,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[24]||(e[24]=l("span",null,"وزن طلا (گرم)",-1)),a($,{modelValue:i.value.goldWeight,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.goldWeight=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:be,rules:me},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[25]||(e[25]=l("span",null,"مبلغ (ریال)",-1)),a($,{modelValue:i.value.goldPrice,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.goldPrice=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:_e},null,8,["modelValue"])]),_:1}),a(g,{cols:"12",class:"my-2"},{default:s(()=>[l("div",qe,[a(S,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:j.value,onClick:Pe},{default:s(()=>e[26]||(e[26]=[p("فروش")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(g,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[l("div",Re,[l("div",Ze,[l("span",Ae,d(c.value.change)+" %",1),e[27]||(e[27]=l("span",{class:"live-tag"},"live",-1))]),e[29]||(e[29]=l("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),l("div",Ke,[D.value?(T(),Z(Ce,{key:0,size:10,color:"#fff",indeterminate:""})):(T(),A("span",Oe,d(_(c.value.buyPrice))+" ریال",1)),e[28]||(e[28]=l("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(C,{value:"three"},{default:s(()=>e[30]||(e[30]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e[47]||(e[47]=l("h3",{class:"title"},"تاریخچه تراکنش ها",-1)),l("div",Je,[l("div",Qe,[a(ae,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=o=>M.value=o),"bg-color":"white"},{default:s(()=>[a(h,{value:"one"},{default:s(()=>e[31]||(e[31]=[p("خرید")])),_:1}),a(h,{value:"two"},{default:s(()=>e[32]||(e[32]=[p("فروش")])),_:1}),a(h,{value:"three"},{default:s(()=>e[33]||(e[33]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(ke,{label:"وضعیت پرداخت",items:ge.value,"item-title":"text","item-value":"value",density:"comfortable",variant:"solo",class:"transaction-filter","onUpdate:modelValue":We},null,8,["items"])]),a(se,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=o=>M.value=o)},{default:s(()=>[a(C,{value:"one",class:"transaction-box"},{default:s(()=>[e[34]||(e[34]=l("div",{class:"d-flex justify-end"},null,-1)),a(ne,{headers:Q.value,items:J.value,loading:V.value,class:"transaction-table"},{"item.status":s(({item:o})=>[l("div",Xe,[a(oe,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[l("p",null,d(_(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[l("p",null,d(_(o.totalPrice)),1)]),_:1},8,["headers","items","loading"])]),_:1}),a(C,{value:"two",class:"transaction-box"},{default:s(()=>[a(ne,{headers:Q.value,items:O.value,loading:V.value,class:"transaction-table"},{"item.status":s(({item:o})=>[l("div",Ye,[a(oe,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[l("p",null,d(_(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[l("p",null,d(_(o.totalPrice)),1)]),_:1},8,["headers","items","loading"])]),_:1}),a(C,{value:"three"},{default:s(()=>e[35]||(e[35]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),a(ue,{"max-width":"500",modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=o=>x.value=o)},{default:s(()=>[a(q,null,{default:s(()=>[l("div",el,[e[40]||(e[40]=l("h3",null,"فاکتور خرید",-1)),l("div",ll,[e[36]||(e[36]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,d(f.value.balance)+" ریال",1)]),l("div",tl,[e[37]||(e[37]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,d(u.value.goldWeight)+" گرم",1)]),l("div",al,[e[38]||(e[38]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,d(u.value.goldprice)+" ریال",1)]),l("div",sl,[e[39]||(e[39]=l("span",{class:"fee"},"کارمزد 0 درصد",-1)),l("div",ol,[l("span",null,d(P.value),1),a(ve)])])]),l("div",nl,[a(S,{text:"پرداخت مستقیم",class:"pay-btn",color:"#9D7E3B",onClick:e[8]||(e[8]=o=>Y("direct"))}),a(S,{text:"پرداخت از کیف پول",class:"pay-btn",color:"#9D7E3B",variant:"outlined",onClick:e[9]||(e[9]=o=>Y("wallet"))})])]),_:1})]),_:1},8,["modelValue"]),a(ue,{"max-width":"500",modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=o=>w.value=o)},{default:s(()=>[a(q,null,{default:s(()=>[l("div",ul,[e[45]||(e[45]=l("h3",null,"فاکتور فروش",-1)),l("div",il,[e[41]||(e[41]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,d(y.value.goldWeight)+" گرم",1)]),l("div",dl,[e[42]||(e[42]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,d(i.value.goldWeight)+" گرم",1)]),l("div",rl,[e[43]||(e[43]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,d(i.value.goldPrice)+" ریال",1)]),l("div",vl,[e[44]||(e[44]=l("span",{class:"fee"},"کارمزد 1 درصد",-1)),l("div",cl,[l("span",null,d(P.value),1),a(ve)])])]),l("div",pl,[a(S,{text:"تایید فروش",class:"pay-btn",color:"#9D7E3B",onClick:e[11]||(e[11]=o=>Ve())})])]),_:1})]),_:1},8,["modelValue"]),r.value?(T(),Z(ie,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(d(m.value),1)]),_:1})):re("",!0),E.value?(T(),Z(ie,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(d(K.value),1)]),_:1})):re("",!0)])}}},yl=ce(gl,[["__scopeId","data-v-600ad874"]]);export{yl as default};
