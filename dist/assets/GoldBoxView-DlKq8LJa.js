import{P as Ge,T as x}from"./trade-5nnJOKsj.js";import{T as pe}from"./TimerIcon-CJ7U5e7E.js";import{_ as ze,r as n,p as me,e as Me,q as J,w as ge,f as Fe,c as Ne,l as a,k as o,g as fe,x as ye,y as De,j as v,o as K,a as l,z as f,m as d,C as D}from"./index-Csfd31CE.js";import{x as be}from"./persian-tools.esm-CBI2Czng.js";const Ee={class:"goldbox-section buy me-2"},$e={class:"live-price-box"},Le={class:"fade-badge"},Re={class:"d-flex justify-center align-center order-2"},qe={class:"price-in-word"},Ae={class:"goldbox-section"},Oe={class:"wallet-box"},Je={class:"d-flex justify-space-between py-2 px-4 my-1"},Ke={class:"mb-0"},He={class:"d-flex justify-space-between py-2 px-4 my-1"},Qe={class:"mb-0"},Xe={class:"my-2"},Ye={class:"goldbox-section sell me-2"},Ze={class:"live-price-box"},el={class:"fade-badge"},ll={class:"d-flex justify-center align-center order-2"},tl={class:"price-in-word"},al={class:"goldbox-section"},sl={class:"wallet-box sell"},ol={class:"d-flex justify-space-between py-2 px-4 my-1"},nl={class:"mb-0"},il={class:"d-flex justify-space-between py-2 px-4 my-1"},ul={class:"mb-0"},dl={class:"my-2"},rl={class:"trade-history pa-md-3"},vl={class:"d-flex flex-column flex-md-row justify-space-between"},cl={class:"d-flex justify-start justify-md-end w-100 mt-3"},pl={class:""},ml={class:""},gl={class:""},fl={class:""},yl={class:"buyModal-content py-10"},bl={class:"wallet-badge my-2"},_l={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},xl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},wl={class:"d-flex justify-space-evenly align-center w-100 my-2"},Pl={class:"d-flex"},Wl={class:"d-flex justify-space-around my-2"},Tl={class:"buyModal-content py-10"},hl={class:"wallet-badge my-2"},Vl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},Il={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},kl={class:"d-flex justify-space-evenly align-center w-100 my-2"},Cl={class:"d-flex"},jl={class:"d-flex justify-space-around my-2"},Sl={__name:"GoldBoxView",setup(Bl){const H=De(),E=n(""),S=n(null),I=n(!1),k=n(!1),Q=n(!1),m=n(""),X=n(""),r=n(!1),$=n(!1),w=n(!1),P=n(!1),p=n(!1),B=n(null),c=n({sellPrice:"",buyPrice:"",change:""}),W=n(30),T=n(!1),Y=n(),Z=n(),ee=n([{title:"تاریخ",key:"date"},{title:"روش ثبت",key:"tradeType"},{title:"زمان",key:"time"},{title:"وزن طلا(گرم)",key:"goldWeight"},{title:"قیمت نهایی",key:"totalPrice"},{title:"قیمت طلا در لحظه",key:"goldPrice"},{title:"وضعیت",key:"status"}]),_e=n([{text:"همه",value:""},{text:"موفق",value:"success"},{text:"ناموفق",value:"failed"},{text:"نامشخص",value:"pending"}]);let U=n(null);const L=n({invoiceId:"",paymentUrl:""}),u=n({goldprice:"",goldWeight:""}),i=n({goldPrice:"",goldWeight:""}),y=n({invoiceId:"",amount:"",isFromWallet:"",balance:0}),b=n({invoiceId:"",amount:"",isFromWallet:"",balance:0,goldWeight:0}),h=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),C=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),R=n({status:""}),q=n({}),xe=[t=>!!t||"مقدار ورودی نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,3})?$/.test(t)||"فقط عدد مجاز است و حداکثر 3 رقم اعشار"],g=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),we=me(()=>{if(u.value.goldprice&&u.value.goldprice!=""){const t=u.value.goldprice.toString().replace(/,/g,""),e=parseInt(t,10);return e<1?"کمتر از یک تومان":be(Math.floor(e))+" تومان"}return""}),Pe=me(()=>{if(i.value.goldPrice&&i.value.goldPrice!=""){const t=i.value.goldPrice.toString().replace(/,/g,""),e=parseInt(t,10);return e<1?"کمتر از یک تومان":be(Math.floor(e))+" تومان"}return""}),le=async()=>{try{Q.value=!0;const t=await Ge.GoldPrice();return c.value.buyPrice=t.buyPrice,c.value.sellPrice=t.sellPrice,c.value.change=t.change,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{Q.value=!1}},We=()=>{u.value.goldprice=u.value.goldprice.replace(/[^0-9]/g,""),u.value.goldWeight=(u.value.goldprice/c.value.buyPrice).toFixed(3)},Te=()=>{u.value.goldWeight=u.value.goldWeight.replace(/[^0-9.]/g,""),console.log(u.value.goldWeight);const t=u.value.goldWeight.split(".");t.length>1&&(u.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(u.value.goldWeight=t[0]+"."+t[1].slice(0,3)),u.value.goldprice=parseInt(u.value.goldWeight*c.value.buyPrice)},he=()=>{i.value.goldPrice=i.value.goldPrice.replace(/[^0-9]/g,""),i.value.goldWeight=(i.value.goldPrice/c.value.sellPrice).toFixed(3)},Ve=()=>{i.value.goldWeight=i.value.goldWeight.replace(/[^0-9.]/g,"");const t=i.value.goldWeight.split(".");t.length>1&&(i.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(i.value.goldWeight=t[0]+"."+t[1].slice(0,3)),i.value.goldPrice=parseInt(i.value.goldWeight*c.value.sellPrice)},te=()=>{p.value=!p.value},Ie=[t=>!!t||"مقدار ورودی نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,3})?$/.test(t)||"فقط عدد مجاز است و حداکثر 3 رقم اعشار"],ke=async()=>{try{I.value=!0,h.value.type="buy",h.value.totalPrice=u.value.goldprice,h.value.goldWeight=u.value.goldWeight,h.value.goldPrice=c.value.buyPrice,console.log(h);const t=await x.createInvoice(h.value);return y.value.invoiceId=t.transactionId,y.value.balance=t.wallet.balance,w.value=!0,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{I.value=!1}},ae=async t=>{try{I.value=!0,t=="wallet"?y.value.isFromWallet=!0:y.value.isFromWallet=!1,y.value.amount=u.value.goldprice;const e=await x.complateTransaction(y.value);return e.isFromWallet==!0?(w.value=!1,J.replace("/")):(L.value.paymentUrl=e.paymentUrl,L.value.invoiceId=e.invoiceId,window.location.href=L.value.paymentUrl),e}catch(e){m.value=e.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{I.value=!1,Transaction()}},Ce=async()=>{try{k.value=!0,C.value.type="sell",C.value.totalPrice=i.value.goldPrice,C.value.goldWeight=i.value.goldWeight,C.value.goldPrice=c.value.sellPrice;const t=await x.createSellInvoice(C.value);return b.value.invoiceId=t.transactionId,b.value.balance=t.wallet.balance,b.value.goldWeight=t.wallet.goldWeight,i.value.goldPrice="",i.value.goldPrice="",P.value=!0,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{k.value=!1}},je=async()=>{try{k.value=!0,b.value.amount=i.value.goldPrice,b.value.fee=1;const t=await x.complateSellTransaction(b.value);return P.value=!1,X.value="طلای شما با موفقیت به فروش رسید",$.value=!0,setTimeout(()=>{$.value=!1},5e3),t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},5e3)}finally{k.value=!1,Transaction()}},Se=t=>{R.value.status=t.value,se(),oe()},se=async()=>{try{T.value=!0;const t=await x.GoldBoxSellTransactions(R.value);return Y.value=t,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{T.value=!1}},oe=async()=>{try{T.value=!0;const t=await x.GoldBoxBuyTransactions(R.value);return Z.value=t,t}catch(t){m.value=t.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}finally{T.value=!1}},Be=async t=>{try{const e=await x.VerifyTransaction(t);return console.log(e),q.value=e,e}catch(e){m.value=e.response.data.msg||"خطایی رخ داده است!",r.value=!0,setTimeout(()=>{r.value=!1},1e4)}};Me(()=>{le(),oe(),se(),setInterval(()=>{le()},3e4),E.value=JSON.parse(localStorage.getItem("user"));const t=n({authority:H.query.Authority,status:H.query.Status});t.value.authority&&t.value.status&&(Be(t.value),t.value.status==="OK"?J.push({name:"success",state:q.value}):J.push({name:"failed",state:q.value}))}),ge(w,t=>{t?(W.value=30,ne()):j()}),ge(P,t=>{t?(W.value=30,ne()):j()});const ne=()=>{j(),U=setInterval(()=>{W.value>0?W.value--:(j(),w.value=!1,P.value=!1)},1e3)},j=()=>{U&&(clearInterval(U),U=null)};return Fe(()=>{j()}),(t,e)=>{const V=v("v-col"),G=v("v-tab"),ie=v("v-tabs"),A=v("v-row"),z=v("v-text-field"),_=v("v-btn"),M=v("v-divider"),O=v("v-container"),F=v("v-tabs-window-item"),ue=v("v-tabs-window"),Ue=v("v-combobox"),N=v("v-chip"),de=v("v-data-table"),re=v("v-card"),ve=v("v-dialog"),ce=v("v-alert");return K(),Ne("div",null,[a(O,{class:"px-0",fluid:""},{default:o(()=>[a(A,{class:"my-1"},{default:o(()=>[a(V,{cols:"12"},{default:o(()=>e[13]||(e[13]=[l("div",{class:"d-flex flex-column align-center"},[l("h3",{class:"title"},"خرید و فروش طلا")],-1)])),_:1}),a(V,{cols:"12"},{default:o(()=>[a(ie,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),"bg-color":"white",class:"tab-header"},{default:o(()=>[a(G,{value:"one"},{default:o(()=>e[14]||(e[14]=[f("خرید")])),_:1}),a(G,{value:"two"},{default:o(()=>e[15]||(e[15]=[f("فروش")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(ue,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=s=>S.value=s),class:"my-1"},{default:o(()=>[a(F,{value:"one"},{default:o(()=>[a(O,null,{default:o(()=>[a(A,null,{default:o(()=>[a(V,{cols:"12",md:"7",class:"pa-0 my-2"},{default:o(()=>[l("div",Ee,[l("div",$e,[e[16]||(e[16]=l("span",{class:"live-tag"},"لحظه ای",-1)),e[17]||(e[17]=l("p",null,"قیمت طلای 18 عیار:",-1)),l("p",Le,d(g(c.value.buyPrice))+" تومان ",1)]),l("div",{class:D(["my-1",{"order-3":p.value,"order-1":!p.value}])},[e[18]||(e[18]=l("span",null,"وزن طلا (گرم)",-1)),a(z,{modelValue:u.value.goldWeight,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.goldWeight=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:Te,rules:Ie,class:"transition-field"},null,8,["modelValue"])],2),l("div",Re,[a(_,{icon:"mdi-swap-horizontal",variant:"text",class:"change-btn",onClick:te})]),l("div",{class:D(["my-1",{"order-1":p.value,"order-3":!p.value}])},[e[19]||(e[19]=l("span",null,"مبلغ (تومان)",-1)),a(z,{modelValue:u.value.goldprice,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.goldprice=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:We,class:"transition-field"},null,8,["modelValue"]),l("p",qe,d(we.value),1)],2)])]),_:1}),a(V,{cols:"12",md:"5",class:"pa-0 my-2"},{default:o(()=>[l("div",Ae,[e[24]||(e[24]=l("div",{class:"Treasury-box"},[l("p",null,"موجودی خزانه :"),l("p",null,"15678 گرم")],-1)),l("div",Oe,[e[20]||(e[20]=l("p",null,"موجودی کیف پول :",-1)),l("p",null,d(g(E.value.balance))+" تومان",1)]),l("div",Je,[e[21]||(e[21]=l("p",{class:"mb-0"},"گرم طلا :",-1)),l("p",Ke,d(u.value.goldWeight)+" گرم",1)]),a(M),e[25]||(e[25]=l("div",{class:"d-flex justify-space-between py-2 px-4 my-1"},[l("p",{class:"mb-0"},"کارمزد خرید :"),l("p",{class:"mb-0"},"0٪")],-1)),a(M),l("div",He,[e[22]||(e[22]=l("p",{class:"mb-0"},"مبلغ قابل پرداخت :",-1)),l("p",Qe,d(g(u.value.goldprice))+" تومان ",1)]),l("div",Xe,[a(_,{color:"#00603a",loading:I.value,onClick:ke,block:""},{default:o(()=>e[23]||(e[23]=[f("خرید")])),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1}),a(F,{value:"two"},{default:o(()=>[a(O,null,{default:o(()=>[a(A,null,{default:o(()=>[a(V,{cols:"12",md:"7",class:"pa-0 my-2"},{default:o(()=>[l("div",Ye,[l("div",Ze,[e[26]||(e[26]=l("span",{class:"live-tag"},"لحظه ای",-1)),e[27]||(e[27]=l("p",null,"قیمت طلای 18 عیار:",-1)),l("p",el,d(g(c.value.buyPrice))+" تومان ",1)]),l("div",{class:D(["my-1",{"order-3":p.value,"order-1":!p.value}])},[e[28]||(e[28]=l("span",null,"وزن طلا (گرم)",-1)),a(z,{modelValue:i.value.goldWeight,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.goldWeight=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:Ve,rules:xe},null,8,["modelValue"])],2),l("div",ll,[a(_,{icon:"mdi-swap-horizontal",variant:"text",class:"change-btn",onClick:te})]),l("div",{class:D(["my-1",{"order-1":p.value,"order-3":!p.value}])},[e[29]||(e[29]=l("span",null,"مبلغ (تومان)",-1)),a(z,{modelValue:i.value.goldPrice,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.goldPrice=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:he},null,8,["modelValue"]),l("p",tl,d(Pe.value),1)],2)])]),_:1}),a(V,{cols:"12",md:"5",class:"pa-0 my-2"},{default:o(()=>[l("div",al,[e[34]||(e[34]=l("div",{class:"Treasury-box sell"},[l("p",null,"موجودی خزانه :"),l("p",null,"15678 گرم")],-1)),l("div",sl,[e[30]||(e[30]=l("p",null,"موجودی صندوق طلا :",-1)),l("p",null,d(E.value.goldWeight)+" گرم",1)]),l("div",ol,[e[31]||(e[31]=l("p",{class:"mb-0"},"گرم طلا :",-1)),l("p",nl,d(i.value.goldWeight)+" گرم",1)]),a(M),e[35]||(e[35]=l("div",{class:"d-flex justify-space-between py-2 px-4 my-1"},[l("p",{class:"mb-0"},"کارمزد فروش :"),l("p",{class:"mb-0"},"1٪")],-1)),a(M),l("div",il,[e[32]||(e[32]=l("p",{class:"mb-0"},"مبلغ قابل پرداخت :",-1)),l("p",ul,d(g(i.value.goldPrice))+" تومان ",1)]),l("div",dl,[a(_,{color:"#930606",loading:k.value,onClick:Ce,block:""},{default:o(()=>e[33]||(e[33]=[f("فروش")])),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[39]||(e[39]=l("h3",{class:"title mt-10"},"تاریخچه تراکنش ها",-1)),l("div",rl,[l("div",vl,[a(ie,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=s=>B.value=s),"bg-color":"white",class:"w-100"},{default:o(()=>[a(G,{value:"one"},{default:o(()=>e[36]||(e[36]=[f("خرید")])),_:1}),a(G,{value:"two"},{default:o(()=>e[37]||(e[37]=[f("فروش")])),_:1})]),_:1},8,["modelValue"]),l("div",cl,[a(Ue,{label:"وضعیت پرداخت",items:_e.value,"item-title":"text","item-value":"value",density:"comfortable",variant:"solo",class:"transaction-filter w-100","onUpdate:modelValue":Se},null,8,["items"])])]),a(ue,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=s=>B.value=s)},{default:o(()=>[a(F,{value:"one",class:"transaction-box"},{default:o(()=>[e[38]||(e[38]=l("div",{class:"d-flex justify-end"},null,-1)),a(de,{headers:ee.value,items:Z.value,loading:T.value,class:"transaction-table"},{"item.status":o(({item:s})=>[l("div",pl,[a(N,{text:s.status=="completed"?"موفق":s.status=="pending"?"نامشخص":"ناموفق",color:s.status=="completed"?"green":s.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":o(({item:s})=>[l("p",null,d(g(s.goldPrice)),1)]),"item.totalPrice":o(({item:s})=>[l("p",null,d(g(s.totalPrice)),1)]),"item.tradeType":o(({item:s})=>[l("div",ml,[a(N,{text:s.tradeType==0?"آنلاین":s.tradeType==1?"تلفنی":s.tradeType==2?"حضوری":"حواله",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1}),a(F,{value:"two",class:"transaction-box"},{default:o(()=>[a(de,{headers:ee.value,items:Y.value,loading:T.value,class:"transaction-table"},{"item.status":o(({item:s})=>[l("div",gl,[a(N,{text:s.status=="completed"?"موفق":s.status=="pending"?"نامشخص":"ناموفق",color:s.status=="completed"?"green":s.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":o(({item:s})=>[l("p",null,d(g(s.goldPrice)),1)]),"item.totalPrice":o(({item:s})=>[l("p",null,d(g(s.totalPrice)),1)]),"item.tradeType":o(({item:s})=>[l("div",fl,[a(N,{text:s.tradeType==0?"آنلاین":s.tradeType==1?"تلفنی":s.tradeType==2?"حضوری":"حواله",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),a(ve,{"max-width":"500",modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=s=>w.value=s),class:"trade-modal"},{default:o(()=>[a(re,{class:"trade-modal"},{default:o(()=>[l("div",yl,[e[44]||(e[44]=l("h3",null,"فاکتور خرید",-1)),l("div",bl,[e[40]||(e[40]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,d(y.value.balance)+" تومان",1)]),l("div",_l,[e[41]||(e[41]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,d(u.value.goldWeight)+" گرم",1)]),l("div",xl,[e[42]||(e[42]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,d(u.value.goldprice)+" تومان",1)]),l("div",wl,[e[43]||(e[43]=l("span",{class:"fee"},"کارمزد 0 درصد",-1)),l("div",Pl,[l("span",null,d(W.value),1),a(pe)])])]),l("div",Wl,[a(_,{text:"پرداخت مستقیم",class:"pay-btn",color:"#9D7E3B",onClick:e[8]||(e[8]=s=>ae("direct"))}),a(_,{text:"پرداخت از کیف پول",class:"pay-btn",color:"#9D7E3B",variant:"outlined",onClick:e[9]||(e[9]=s=>ae("wallet"))})])]),_:1})]),_:1},8,["modelValue"]),a(ve,{"max-width":"500",modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=s=>P.value=s)},{default:o(()=>[a(re,null,{default:o(()=>[l("div",Tl,[e[49]||(e[49]=l("h3",null,"فاکتور فروش",-1)),l("div",hl,[e[45]||(e[45]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,d(b.value.goldWeight)+" گرم",1)]),l("div",Vl,[e[46]||(e[46]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,d(i.value.goldWeight)+" گرم",1)]),l("div",Il,[e[47]||(e[47]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,d(i.value.goldPrice)+" تومان",1)]),l("div",kl,[e[48]||(e[48]=l("span",{class:"fee"},"کارمزد 1 درصد",-1)),l("div",Cl,[l("span",null,d(W.value),1),a(pe)])])]),l("div",jl,[a(_,{text:"تایید فروش",class:"pay-btn",color:"#9D7E3B",onClick:e[11]||(e[11]=s=>je())})])]),_:1})]),_:1},8,["modelValue"]),r.value?(K(),fe(ce,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[f(d(m.value),1)]),_:1})):ye("",!0),$.value?(K(),fe(ce,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[f(d(X.value),1)]),_:1})):ye("",!0)])}}},Fl=ze(Sl,[["__scopeId","data-v-52af294a"]]);export{Fl as default};
